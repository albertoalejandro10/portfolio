import{B as x,C as B,D as A}from"./DDU5pMrJ.js";import{h as C,f as M,a as I}from"./1m1goCJg.js";import{f as D,n as L}from"./iik6CYzq.js";import{m as U,L as T,k as V,c as j,p as P,r as W,w as q,a1 as E,a2 as K,a3 as d,M as F}from"./BKZ8r7iz.js";function z(e,n){return n.reduce((t,o)=>{const r=G(e,o);return r!==void 0&&(t[o]=r),t},{})}function G(e,n){return n.split(".").reduce((t,o)=>t&&t[o],e)}const y="default",S=/^@|^v-on:/,O=/^:|^v-bind:/,H=/^v-model/,J=["select","textarea","input"],Q=["math","svg"],X=Object.fromEntries(["p","a","blockquote","code","pre","code","em","h1","h2","h3","h4","h5","h6","hr","img","ul","ol","li","strong","table","thead","tbody","td","th","tr","script"].map(e=>[e,`prose-${e}`])),Y=["script","base"],Z=U({name:"MDCRenderer",props:{body:{type:Object,required:!0},data:{type:Object,default:()=>({})},class:{type:[String,Object],default:void 0},tag:{type:[String,Boolean],default:void 0},prose:{type:Boolean,default:void 0},components:{type:Object,default:()=>({})},unwrap:{type:[Boolean,String],default:!1}},async setup(e){const t=V()?.appContext?.app?.$nuxt,o=t?.$route||t?._route,{mdc:r}=t?.$config?.public||{},s=j(()=>({...r?.components?.prose&&e.prose!==!1?X:{},...r?.components?.map||{},...P(e.data?.mdc?.components||{}),...e.components})),p=j(()=>{const i=(e.body?.children||[]).map(c=>c.tag||c.type).filter(c=>!C.includes(c));return Array.from(new Set(i)).sort().join(".")}),u=W({...e.data});q(()=>e.data,i=>{Object.assign(u,i)}),await ae(e.body,{tags:s.value});function a(i,c){const l=i.split(".").length-1;return i.split(".").reduce((f,m,v)=>v==l&&f?(f[m]=c,f[m]):typeof f=="object"?f[m]:void 0,u)}return{tags:s,contentKey:p,route:o,runtimeData:u,updateRuntimeData:a}},render(e){const{tags:n,tag:t,body:o,data:r,contentKey:s,route:p,unwrap:u,runtimeData:a,updateRuntimeData:i}=e;if(!o)return null;const c={...r,tags:n,$route:p,runtimeData:a,updateRuntimeData:i},l=t!==!1?b(t||c.component?.name||c.component||"div"):void 0;return l?T(l,{...c.component?.props,class:e.class,...this.$attrs,key:s},{default:f}):f?.();function f(){const m=w(o,T,{documentMeta:c,parentScope:c,resolveComponent:b});return m?.default?u?D(m.default(),typeof u=="string"?u.split(" "):["*"]):m.default():null}}});function k(e,n,t,o){const{documentMeta:r,parentScope:s,resolveComponent:p}=t;if(e.type==="text")return n(d,e.value);if(e.type==="comment")return n(F,null,e.value);const u=e.tag,a=N(e,r.tags);if(e.tag==="binding")return ee(e,n,r,s);const i=R(a)?f=>f:p;if(Y.includes(a))return n("pre",{class:"mdc-renderer-dangerous-tag"},"<"+a+">"+L(e)+"</"+a+">");const c=i(a);typeof c=="object"&&(c.tag=u);const l=te(e,r);return o&&(l.key=o),n(c,l,w(e,n,{documentMeta:r,parentScope:{...s,...l},resolveComponent:i}))}function w(e,n,t){const{documentMeta:o,parentScope:r,resolveComponent:s}=t,u=(e.children||[]).reduce((i,c)=>{if(!ce(c))return i[y].children.push(c),i;const l=ie(c);return i[l]=i[l]||{props:{},children:[]},c.type==="element"&&(i[l].props=c.props,i[l].children.push(...c.children||[])),i},{[y]:{props:{},children:[]}});return Object.entries(u).reduce((i,[c,{props:l,children:f}])=>(f.length&&(i[c]=(m={})=>{const v=z(m,Object.keys(l||{}));let h=f.map((_,$)=>k(_,n,{documentMeta:o,parentScope:{...r,...v},resolveComponent:s},String(_.props?.key||$)));return l?.unwrap&&(h=D(h,l.unwrap)),ue(h)}),i),{})}function ee(e,n,t,o={}){const r={...t.runtimeData,...o,$document:t,$doc:t},s=/\.|\[(\d+)\]/,u=(e.props?.value.trim().split(s).filter(Boolean)).reduce((i,c)=>{if(i&&c in i)return typeof i[c]=="function"?i[c]():i[c]},r),a=e.props?.defaultValue;return n(d,u??a??"")}function te(e,n){const{tag:t="",props:o={}}=e;return Object.keys(o).reduce(function(r,s){if(s==="__ignoreMap")return r;const p=o[s];if(H.test(s))return ne(s,p,r,n,{native:J.includes(t)});if(s==="v-bind")return re(s,p,r,n);if(S.test(s))return oe(s,p,r,n);if(O.test(s))return se(s,p,r,n);const{attribute:u}=M(I,s);return Array.isArray(p)&&p.every(a=>typeof a=="string")?(r[u]=p.join(" "),r):(r[u]=p,r)},{})}function ne(e,n,t,o,{native:r}){const s=e.match(/^v-model:([^=]+)/)?.[1]||"modelValue",p=r?"value":s,u=r?"onInput":`onUpdate:${s}`;return t[p]=g(n,o.runtimeData),t[u]=a=>{o.updateRuntimeData(n,r?a.target?.value:a)},t}function re(e,n,t,o){const r=g(n,o);return t=Object.assign(t,r),t}function oe(e,n,t,o){return e=e.replace(S,""),t.on=t.on||{},t.on[e]=()=>g(n,o),t}function se(e,n,t,o){return e=e.replace(O,""),t[e]=g(n,o),t}const b=e=>{if(typeof e=="string"){if(C.includes(e))return e;const n=E(x(e),!1);return!e||n?.name==="AsyncComponentWrapper"||typeof n=="string"?n:"setup"in n?K(()=>new Promise(t=>t(n))):n}return e};function g(e,n){const t=e.split(".").reduce((o,r)=>typeof o=="object"?o[r]:void 0,n);return typeof t>"u"?A(e):t}function ie(e){let n="";for(const t of Object.keys(e.props||{}))if(!(!t.startsWith("#")&&!t.startsWith("v-slot:"))){n=t.split(/[:#]/,2)[1];break}return n||y}function ce(e){return e.tag==="template"}function R(e){return Q.includes(e)}function ue(e){const n=[];for(const t of e){const o=n[n.length-1];t.type===d&&o?.type===d?o.children=o.children+t.children:n.push(t)}return n}async function ae(e,n){if(!e)return;const t=Array.from(new Set(o(e,n)));await Promise.all(t.map(async r=>{if(r?.render||r?.ssrRender||r?.__ssrInlineRender)return;const s=b(r);s?.__asyncLoader&&!s.__asyncResolved&&await s.__asyncLoader()}));function o(r,s){const p=r.tag;if(r.type==="text"||p==="binding"||r.type==="comment")return[];const u=N(r,s.tags);if(R(u))return[];const a=[];r.type!=="root"&&!C.includes(u)&&a.push(u);for(const i of r.children||[])a.push(...o(i,s));return a}}function N(e,n){const t=e.tag;return!t||typeof e.props?.__ignoreMap<"u"?t:n[t]||n[x(t)]||n[B(e.tag)]||t}const de=Object.assign(Z,{__name:"MDCRenderer"});export{de as M};
